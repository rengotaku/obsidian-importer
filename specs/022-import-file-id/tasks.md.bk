# Tasks: LLMã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ã®file_idä»˜ä¸

**Input**: Design documents from `/specs/022-import-file-id/`
**Prerequisites**: plan.md, spec.md, research.md, data-model.md

**Tests**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ãŸã‚ã€å¤‰æ›´ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å«ã‚ã‚‹ã€‚

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (e.g., US1, US2)
- Include exact file paths in descriptions

## Path Conventions

```text
development/scripts/llm_import/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ file_id.py              # æ–°è¦
â”‚   â”œâ”€â”€ knowledge_extractor.py  # å¤‰æ›´
â”‚   â””â”€â”€ state.py                # å¤‰æ›´
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_file_id.py         # æ–°è¦
â”‚   â””â”€â”€ test_cli.py             # å¤‰æ›´
â””â”€â”€ cli.py                      # å¤‰æ›´
```

---

## Phase 1: Setup

**Purpose**: æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ

- [ ] T001 Create file_id.py module with generate_file_id() in development/scripts/llm_import/common/file_id.py

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: file_idç”Ÿæˆã®åŸºç›¤ãƒ†ã‚¹ãƒˆ

**âš ï¸ CRITICAL**: US1/US2 ã¯ file_id ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã«ä¾å­˜

- [ ] T002 [P] Create test_file_id.py with unit tests in development/scripts/llm_import/tests/test_file_id.py
- [ ] T003 Run make test to verify file_id generation tests pass

**Checkpoint**: file_id ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ç¢ºèªå®Œäº†

---

## Phase 3: User Story 1 - ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®file_idè‡ªå‹•ä»˜ä¸ (Priority: P1) ğŸ¯ MVP

**Goal**: ç”Ÿæˆã•ã‚Œã‚‹ãƒŠãƒ¬ãƒƒã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®frontmatterã«file_idã‚’è‡ªå‹•ä»˜ä¸

**Independent Test**: `make llm-import LIMIT=1` å®Ÿè¡Œ â†’ ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã®frontmatterã«`file_id: [12æ–‡å­—16é€²æ•°]`ç¢ºèª

### Implementation for User Story 1

- [ ] T004 [US1] Add file_id field to KnowledgeDocument dataclass in development/scripts/llm_import/common/knowledge_extractor.py
- [ ] T005 [US1] Update to_markdown() to output file_id in frontmatter in development/scripts/llm_import/common/knowledge_extractor.py
- [ ] T006 [US1] Import generate_file_id and integrate file_id generation in cli.py's process_conversation() in development/scripts/llm_import/cli.py
- [ ] T007 [US1] Handle chunked conversations - each chunk gets unique file_id in development/scripts/llm_import/cli.py
- [ ] T008 [P] [US1] Add test for file_id in frontmatter output in development/scripts/llm_import/tests/test_cli.py
- [ ] T009 [US1] Run make test to verify US1 implementation

**Checkpoint**: US1å®Œäº† - frontmatterã«file_idå‡ºåŠ›ã‚’ç¢ºèª

---

## Phase 4: User Story 2 - state.jsonã§ã®file_idè¨˜éŒ² (Priority: P2)

**Goal**: state.jsonã®processedã‚¨ãƒ³ãƒˆãƒªã«file_idã‚’è¨˜éŒ²

**Independent Test**: ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã«state.jsonç¢ºèª â†’ processedã‚¨ãƒ³ãƒˆãƒªã«file_idå«ã¾ã‚Œã‚‹

### Implementation for User Story 2

- [ ] T010 [US2] Add file_id field to ProcessedEntry dataclass in development/scripts/llm_import/common/state.py
- [ ] T011 [US2] Update ProcessedEntry.from_dict() to handle optional file_id in development/scripts/llm_import/common/state.py
- [ ] T012 [US2] Update ProcessedEntry.to_dict() to include file_id in development/scripts/llm_import/common/state.py
- [ ] T013 [US2] Update StateManager.add_entry() to accept file_id parameter in development/scripts/llm_import/common/state.py
- [ ] T014 [US2] Pass file_id to add_entry() in cli.py after successful processing in development/scripts/llm_import/cli.py
- [ ] T015 [P] [US2] Add test for file_id in state.json output in development/scripts/llm_import/tests/test_cli.py
- [ ] T016 [US2] Run make test to verify US2 implementation

**Checkpoint**: US2å®Œäº† - state.jsonã«file_idè¨˜éŒ²ã‚’ç¢ºèª

---

## Phase 5: Polish & Verification

**Purpose**: çµ±åˆãƒ†ã‚¹ãƒˆã¨æœ€çµ‚ç¢ºèª

- [ ] T017 Run full integration test with make llm-import ACTION=preview
- [ ] T018 Verify edge cases: empty content, Japanese titles, long content
- [ ] T019 Run make test to verify all tests pass
- [ ] T020 Update quickstart.md with actual test results if needed

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies
- **Foundational (Phase 2)**: Depends on Phase 1
- **US1 (Phase 3)**: Depends on Phase 2
- **US2 (Phase 4)**: Depends on Phase 2 (can run parallel with US1 if desired)
- **Polish (Phase 5)**: Depends on Phase 3, 4

### User Story Dependencies

- **US1 (P1)**: file_id.py â†’ KnowledgeDocument â†’ cli.py çµ±åˆ
- **US2 (P2)**: file_id.py â†’ ProcessedEntry â†’ StateManager â†’ cli.py çµ±åˆ

### Within Each User Story

- Models before integration
- Integration before tests
- Tests verify functionality

### Parallel Opportunities

- T002 (test_file_id.py) can run parallel with foundational setup
- T008 (US1 test) can run parallel after T007
- T015 (US2 test) can run parallel after T014
- US1 and US2 can be worked on in parallel after Phase 2

---

## Parallel Example: Phase 3 (US1)

```bash
# After T003 completes, these can start:
Task: T004 [US1] Add file_id field to KnowledgeDocument
Task: T010 [US2] Add file_id field to ProcessedEntry  # Can start in parallel!

# Within US1, sequential flow:
T004 â†’ T005 â†’ T006 â†’ T007 â†’ T008 â†’ T009
```

---

## Implementation Strategy

### MVP First (User Story 1 Only)

1. Complete Phase 1: Setup (T001)
2. Complete Phase 2: Foundational (T002-T003)
3. Complete Phase 3: User Story 1 (T004-T009)
4. **STOP and VALIDATE**: `make llm-import LIMIT=1` ã§ frontmatter ç¢ºèª
5. Deploy if ready

### Incremental Delivery

1. Setup + Foundational â†’ file_id ç”ŸæˆåŸºç›¤å®Œäº†
2. Add User Story 1 â†’ frontmatter å‡ºåŠ›å®Œäº† (MVP!)
3. Add User Story 2 â†’ state.json è¨˜éŒ²å®Œäº†
4. Polish â†’ çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†

---

## Test Coverage Rules

**å¢ƒç•Œãƒ†ã‚¹ãƒˆã®åŸå‰‡**: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒç™ºç”Ÿã™ã‚‹å¢ƒç•Œã§ãƒ†ã‚¹ãƒˆ

```
[ã‚³ãƒ³ãƒ†ãƒ³ãƒ„] â†’ [file_idç”Ÿæˆ] â†’ [KnowledgeDocument] â†’ [to_markdown()] â†’ [ãƒ•ã‚¡ã‚¤ãƒ«æ›¸è¾¼]
     â†“              â†“                 â†“                  â†“              â†“
  å…¥åŠ›æ¤œè¨¼    test_file_id.py    ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç¢ºèª    frontmatterå‡ºåŠ›    çµ±åˆãƒ†ã‚¹ãƒˆ
```

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [x] file_id ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ (T002)
- [x] frontmatter å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆ (T008)
- [x] state.json å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆ (T015)
- [x] End-to-End ãƒ†ã‚¹ãƒˆ (T017)

---

## Notes

- [P] tasks = different files, no dependencies
- [Story] label maps task to specific user story
- Each user story is independently completable and testable
- Commit after each task or logical group
- æ—¢å­˜ state.json ã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒï¼ˆOptional ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
