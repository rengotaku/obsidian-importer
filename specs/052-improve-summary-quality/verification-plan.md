# 検証計画: プロンプト改善の効果測定

**目的**: 実装方針を決定する前に、LLM の実際の出力を収集・分析する
**状態**: ✅ 完了（2026-02-15）
**結論**: V2（定性的指示のみ）を採用。数値しきい値は不要。
**結果**: [verification-results.md](./verification-results.md) 参照
**出力**: [verification-outputs/](./verification-outputs/) 参照

## 検証モデル

- **モデル**: `gpt-oss:20b`（本番環境と同一）
- **設定**: temperature=0.2, num_predict=16384, timeout=300

## 検証項目

### 1. プロンプト変更の効果測定

| # | 検証項目 | 入力 | 測定指標 | 期待値 |
|---|---------|------|---------|--------|
| V1 | 現行プロンプト（ベースライン） | サンプル会話 5件 | 圧縮率、文字数 | 現状把握 |
| V2 | 定性的指示追加 | 同上 | 圧縮率、文字数 | 改善 |
| V3 | 具体的数値指示追加 | 同上 | 圧縮率、文字数 | 改善 |
| V4 | 両方追加 | 同上 | 圧縮率、文字数 | 最善 |

### 2. サンプル会話の選定

| # | カテゴリ | 元サイズ | ソース | ファイル名 |
|---|---------|---------|--------|-----------|
| S1 | 短い会話 | 1.4KB | organized | キッザニアの仕事体験とキッゾ給料システム.md |
| S2 | 中程度 | 2.5KB | organized | SREとDevOps おすすめ書籍まとめ.md |
| S3 | 表形式含む | 12.5KB | review | 千葉のSwitch2販売実績.md |
| S4 | コード含む | 3.2KB | organized | JavaScript 3D デッサン人形作成.md |
| S5 | 長い会話 | 14.7KB | review | SuperClaude subagent strategy.md |

### 3. プロンプトバリエーション

#### V1: 現行プロンプト（ベースライン）
- `src/obsidian_etl/utils/prompts/knowledge_extraction.txt` をそのまま使用

#### V2: 定性的指示追加
```text
追加セクション:
## 分析・考察の記述
- 「なぜそうなるか」の理由を必ず説明
- データから読み取れるパターンや傾向を明記
- 結論だけでなく根拠も記述

## 表形式データの保持
- 表形式データは必ず Markdown 表で保持
- 数値・日付は省略せず記載
```

#### V3: 具体的数値指示追加
```text
追加セクション:
## 出力量の目安
- 元の会話の 20% 以上の文字数を目標
- 最低 300 文字以上
- 短い会話でも重要情報は省略しない
```

#### V4: 両方追加
- V2 + V3 の両方を含む

## 実行手順

1. **サンプル選定**: organized/ と review/ から 5件を選定
2. **ベースライン測定**: 現行プロンプトで各サンプルを処理
3. **バリエーション測定**: V2, V3, V4 それぞれで同じサンプルを処理
4. **結果収集**: 各出力の文字数、圧縮率、品質（表形式保持等）を記録
5. **分析・決定**: 最も効果的なアプローチを特定

## 結果記録テンプレート

| サンプル | 元サイズ | V1出力 | V1圧縮率 | V2出力 | V2圧縮率 | V3出力 | V3圧縮率 | V4出力 | V4圧縮率 |
|---------|---------|--------|---------|--------|---------|--------|---------|--------|---------|
| S1 | | | | | | | | | |
| S2 | | | | | | | | | |
| S3 | | | | | | | | | |
| S4 | | | | | | | | | |
| S5 | | | | | | | | | |

## 品質チェック項目

各出力について以下を確認:

- [ ] 圧縮率がしきい値を満たすか
- [ ] 表形式データが保持されているか
- [ ] 理由・背景の説明が含まれているか
- [ ] 数値・日付が正確に含まれているか
- [ ] 無駄な水増し（冗長な表現）がないか

## 次のステップ

1. サンプル会話を 5件選定
2. 各プロンプトバリエーションで Ollama 実行
3. 結果を上記テーブルに記録
4. 最適なアプローチを決定
5. spec.md と tasks.md を更新
